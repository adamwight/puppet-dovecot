<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.13
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-dovecot">dovecot</h1>

<h4 id="label-Table+of+Contents">Table of Contents</h4>
<ol><li>
<p><a href="#label-Description">Description</a></p>
</li><li>
<p><a href="#label-Setup+and+usage">Setup and Usage - The basics of getting started
with dovecot</a></p>
<ul><li>
<p><a href="#label-What+this+module+affects">What this module affects</a></p>
</li><li>
<p><a href="#label-Configuration+options">Configuration options</a></p>
</li><li>
<p><a href="#label-External+config+files">External config files</a></p>
</li></ul>
</li><li>
<p><a href="#label-Reference">Reference - An under-the-hood peek at what the module
is doing and how</a></p>
</li><li>
<p><a href="#label-Limitations">Limitations - OS compatibility, etc.</a></p>
</li><li>
<p><a href="#label-Development">Development - Guide for contributing to the
module</a></p>
</li></ol>

<h2 id="label-Description">Description</h2>

<p>This module installs and manages the dovecot imap server and its plugins,
and provides resources and functions to configure the dovecot system. It
does, however, not configure any of those systems beyond the upstream
defaults.</p>

<p>This module is intended to work with Puppet 5, tested dovceot and OS
versions are listed below. Patches to support other setups are welcome.</p>

<h2 id="label-Setup+and+Usage">Setup and Usage</h2>

<h3 id="label-What+this+module+affects">What this module affects</h3>

<p>By default, this packageâ€¦</p>
<ul><li>
<p>installs the dovecot package</p>
</li><li>
<p>recursively purges all dovecot config</p>
</li></ul>

<h3 id="label-Configuration+options">Configuration options</h3>

<p>While on a puppet-managed host, splitting the config into multiple conf.d
files provides not much advantage, this module supports managing both the
dovecot.conf file and several conf.d files.</p>

<p>The dovecot class takes two parameters, $config for dovecot.conf entries
and $configs for conf.d file entries:</p>

<pre class="code ruby"><code class="ruby">class { &#39;dovecot&#39;:
  plugins =&gt; [&#39;imap&#39;, &#39;lmtp&#39;],
  config =&gt; {
    protocols =&gt; &#39;imap lmtp&#39;,
    listen    =&gt; &#39;*, ::&#39;,
  },
  configs =&gt; {
    &#39;10-auth&#39; =&gt; {
      passdb =&gt; {
        driver =&gt; &#39;passwd-file&#39;,
        args   =&gt; &#39;username_format=%u /etc/dovecot/virtual_accounts_passwd&#39;,
      },
    },
    &#39;10-logging&#39; =&gt; {
      log_path =&gt; &#39;syslog&#39;,
    },
  }
}
</code></pre>

<p>This can be conveniently used from hiera:</p>

<pre class="code ruby"><code class="ruby">dovecot::plugins:
  - imap
  - lmtp
  - sieve
dovecot::config:
  protocols: imap sieve lmtp
  hostname: &quot;%{::fqdn}&quot;
dovecot::configs:
  &#39;10-auth&#39;:
    disable_plaintext_auth: yes
    passdb:
      driver: passwd-file
      args: scheme=CRYPT username_format=%u /etc/dovecot/virtual_accounts_passwd
  &#39;10-master&#39;:
    default_process_limit: 200
    default_client_limit: 2000
    service lmtp:
      unix_listener /var/spool/postfix/private/dovecot-lmtp:
        user: postfix
        group: postfix
        mode: &#39;0600&#39;
  &#39;10-ssl&#39;:
    ssl: yes
    ssl_cert: &#39;&lt;/etc/dovecot/ssl/dovecot.crt&#39;
    ssl_key: &#39;&lt;/etc/dovecot/ssl/dovecot.key&#39;
</code></pre>

<p>For advanced use-cases you can also use the provided
<code>dovecot::create_config_resources</code> and
<code>dovecot::create_config_file_resources</code> functions, that are used
to handle the $config and $configs parameters.</p>

<p>If you want to use the dovecot::config resource directly, the easiest way
is to put both the file (optional) and the hierachical config key into the
resource title:</p>

<pre class="code ruby"><code class="ruby">dovecot::config {
  &#39;protocols&#39;: value =&gt; &#39;imap lmtp&#39;;
  &#39;listen&#39;:
     value =&gt; &#39;*, ::&#39;,
     comment =&gt; &#39;Listen on all interfaces&#39;,
  ;
  &#39;10-auth:passdb.driver&#39;: value =&gt; &#39;passwd-file&#39;;
  &#39;10-auth:passdb.args&#39;: value =&gt; &#39;username_format=%u /etc/dovecot/virtual_accounts_passwd&#39;
}
</code></pre>

<p>But you can also specify them separately:</p>

<pre class="code ruby"><code class="ruby">dovecot::config { &#39;dovecot passdb driver&#39;:
  file     =&gt; &#39;10-auth&#39;,
  sections =&gt; [&#39;passdb&#39;],
  key      =&gt; &#39;driver&#39;,
  value    =&gt; &#39;passwd-file&#39;,
}
</code></pre>

<p>By default all regular config files are created with mode 0644, but this
can be changed by creating the <code>dovecot::configfile</code> instance
manually and specifying the <code>$mode</code> param, or by setting the
global <code>dovecot::configs_mode</code> parameter/hiera key.</p>

<h3 id="label-External+config+files">External config files</h3>

<p>In some cases, dovecot requires an external config file to be passed as a
config value. This is especially the case for SQL- and LDAP-based userdbs.</p>

<p>These external config files are using a similar syntax, but are parsed by a
different parser (and at a different point of time), as <a
href="https://wiki.dovecot.org/ConfigFile#External_config_files">explained
in the Dovecot wiki</a>.</p>

<p>This module supports such external config files using the
<code>dovecot::extconfigfile</code> type, or the
<code>dovecot::extconfigs</code> parameter/hiera key:</p>

<pre class="code ruby"><code class="ruby">dovecot::configs:
  &#39;10-auth&#39;:
    passdb:
      driver: sql
      args: /etc/dovecot/dovecot-sql.conf.ext
dovecot::extconfigs:
  &#39;dovecot-sql.conf.ext&#39;:
     driver: pgsql
     connect: host=sql.example.com dbname=virtual user=virtual password=blarg
     default_pass_scheme: SHA256-CRYPT
     password_query: &quot;SELECT email as user, password FROM virtual_users WHERE email=&#39;%u&#39;;&quot;
</code></pre>

<p>Since external config files often contain sensitive information like
database passwords, they are set to mode 0600 by default. This can be
changed using the type&#39;s <code>$mode</code> parameter, or the global
<code>dovecot::extconfigs_mode</code> parameter/hiera key.</p>

<p><em>NOTE</em>: These external config files are usually stored in
<code>/etc/dovecot</code>. Unfortunately, the example-config delivered with
Dovecot also contains <code>.conf.ext</code> files in <code>conf.d/</code>,
which are !included from <code>10-auth.conf</code>. Please note that these
are <em>not</em> external config files as explained here, they are included
and parsed by the normal config parser. The example config splits them out
to provide multiple options the user can easily choose one from. In a
puppet-based setup, this should not be necessary, and is thus currently not
supported by this module. Please provide a valid use-case as a bug report,
if you have one.</p>

<h2 id="label-Reference">Reference</h2>

<p>See the reference generated by puppet strings on <a
href="https://oxc.github.io/puppet-dovecot">oxc.github.io/puppet-dovecot</a>/</p>

<h2 id="label-Limitations">Limitations</h2>

<p>OS Versions tested:</p>
<ul><li>
<p>CentOS 7</p>
</li><li>
<p>FreeBSD 11</p>
</li><li>
<p>Ubuntu 14.04, 16.04</p>
</li></ul>

<p>dovecot versions tested:</p>
<ul><li>
<p>2.2.10, 2.2.22</p>
</li></ul>

<p>Feel free to let me know if it correctly works on a different OS/setup, or
submit patches if it doesn&#39;t.</p>

<h2 id="label-Development">Development</h2>

<p>You&#39;re welcome to submit patches and issues to the issue tracker on
Github.</p>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>