# dovecot

#### Table of Contents

1. [Description](#description)
1. [Setup - The basics of getting started with dovecot](#setup)
    * [What dovecot affects](#what-dovecot-affects)
    * [Beginning with dovecot](#beginning-with-dovecot)
1. [Usage - Configuration options and additional functionality](#usage)
1. [Reference - An under-the-hood peek at what the module is doing and how](#reference)
1. [Limitations - OS compatibility, etc.](#limitations)
1. [Development - Guide for contributing to the module](#development)

## Description

This module installs and manages the dovecot imap server and its plugins, and provides
resources and functions to configure the dovecot system. 
It does, however, not configure any of those systems beyond the upstream defaults.

This module is intended to work with Puppet 4 and has been tested with 
dovecot 2.2.22 on Ubuntu 16.04. Patches to support other setups are welcome.

## Setup

### What dovecot affects

By default, this package...

* installs the dovecot package
* recursively purges all dovecot config

### Beginning with dovecot

The dovecot::config resource can be used to specify custom configuration entries.
The easiest way to use it, is to put both the file and the hierachical config
key into the resource title:

```puppet
class { 'dovecot':
  plugins => ['imap', 'lmtp'],
}
dovecot::config {
  'protocols': value => 'imap lmtp';
  'listen': value => '*, ::';
  'passdb.driver': value => 'passwd-file';
  'passdb.args': value => 'username_format=%u /etc/dovecot/virtual_accounts_passwd'
}
```

This results the following config file `/etc/dovecot/dovecot.conf`:

```
# This file is managed by Puppet. DO NOT EDIT.
listen = *, ::
protocols = imap sieve lmtp
passdb {
  args = scheme=CRYPT username_format=%u /etc/dovecot/virtual_accounts_passwd
  driver = passwd-file
}
```

The provided `dovecot::create_config_resources` and `dovecot::create_config_file_resources`
functions allow for a much more convenient usage, especially with values stored in hiera:

```puppet
class profile::dovecot {
  dovecot::create_config_resources(hiera_hash("${title}::config", {}))
  dovecot::create_config_file_resources(hiera_hash("${title}::configs", {}))
}
```

```yaml
profile::dovecot::config:
  protocols: imap sieve lmtp
  hostname: "%{::fqdn}"  
profile::dovecot::configs:
  '10-auth':
    disable_plaintext_auth: yes
    passdb:
      driver: passwd-file
      args: scheme=CRYPT username_format=%u /etc/dovecot/virtual_accounts_passwd
  '10-master':
    default_process_limit: 200
    default_client_limit: 2000
    service lmtp:
      unix_listener /var/spool/postfix/private/dovecot-lmtp:
        user: postfix
        group: postfix
        mode: '0600'
  '10-ssl':
    ssl: yes
    ssl_cert: '</etc/dovecot/ssl/dovecot.crt'
    ssl_key: '</etc/dovecot/ssl/dovecot.key'    
```


## Reference

See the reference generated by puppet strings on https://oxc.github.io/puppet-dovecot/

## Limitations

OS Versions tested:

* Ubuntu 16.04

dovecot versions tested:

* 2.2.22

Feel free to let me know if it correctly works on a different OS/setup, or 
submit patches if it doesn't.

## Development

You're welcome to submit patches and issues to the issue tracker on Github.

